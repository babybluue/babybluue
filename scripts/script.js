const disableScale=()=>{if(window.matchMedia("(display-mode: standalone)").matches||navigator.standalone){const e=document.querySelector("meta[name=viewport]");window.oncontextmenu=e=>e.preventDefault(),e.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,,viewport-fit=cover")}},showTip=()=>{const s=document.querySelector(".tip");navigator.serviceWorker&&-1==location.href.indexOf("localhost")&&navigator.serviceWorker.register("/sw.js").then(()=>{let e=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{e||(e=!0,window.location.reload())});const t=new BroadcastChannel("install");t.onmessage=e=>{e.data="install from sw",s.classList.remove("disappear")}})},handleTip=()=>{const t=document.querySelector(".tip"),e=document.querySelector(".positive-btn"),s=document.querySelector(".negative-btn");e.addEventListener("click",()=>{if(t.classList.add("disappear"),BroadcastChannel){const e=new BroadcastChannel("install");e.postMessage("update")}else console.log("not support BroadcastChannel"),location.reload()}),s.addEventListener("click",()=>{t.classList.add("disappear")})},setRecentTime=()=>{const e=document.querySelector(".last-modified");var t;e&&(t=new Date((new Date).getTime()+288e5).toISOString().replace("T"," ").slice(0,19),e.querySelector("small").textContent=t)},avatarAnimation=()=>{const e=document.querySelector(".last-modified"),t=document.querySelector(".avatar");t&&(t.addEventListener("mouseenter",()=>{t.classList.add("rotate"),e&&e.classList.remove("disappear")}),t.addEventListener("mouseleave",()=>{t.classList.remove("rotate"),e&&e.classList.add("disappear")}),t.addEventListener("touchstart",()=>{t.classList.add("rotate"),e&&e.classList.remove("disappear")},{passive:!0}),t.addEventListener("touchend",()=>{t.classList.remove("rotate"),e&&e.classList.add("disappear")},{passive:!0}))},animateProgressBar=({progressBar:e,topArea:t})=>{var s=document.body.scrollHeight||document.documentElement.scrollHeight,o=window.innerHeight||document.documentElement.clientHeight,a=document.body.scrollTop||document.documentElement.scrollTop,a=Math.round(a/(s-o)*100);e&&(e.style.width=a+"%"),0!==window.scrollY?(t.style.setProperty("transform","rotate(0)"),t.classList.add("to-down")):(t.style.setProperty("transform","rotate(180deg)"),t.classList.remove("to-down"))},pageScroll=()=>{const t=document.querySelector(".top"),e=document.querySelector(".progress-bar");200<document.documentElement.scrollHeight-document.documentElement.clientHeight&&(t.style.display="block"),t.addEventListener("click",()=>{var e=document.body.scrollHeight||document.documentElement.scrollHeight;t.classList.contains("to-down")?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:e,behavior:"smooth"})}),window.addEventListener("scroll",()=>{animateProgressBar({topArea:t,progressBar:e})})},setTheme=()=>{var e=document.documentElement;const t=document.querySelector(".theme-icon"),s=localStorage.theme,o=window.matchMedia("(prefers-color-scheme: dark)");t&&(setIcon({isExit:s,icon:t,mode:o}),toggleTheme({icon:t,mode:o,htmlEl:e})),s||o.addEventListener("change",()=>{setIcon({isExit:s,icon:t,mode:o})})},setIcon=({isExit:e,icon:t,mode:s})=>{e?t.setAttribute("style",`background:url(/images/${e}.png)`):s.matches?t.setAttribute("style","background:url(/images/dark.png)"):t.setAttribute("style","background:url(/images/light.png)")},toggleTheme=({icon:s,htmlEl:o,mode:a})=>{s.addEventListener("click",()=>{var e=o.getAttribute("data-theme"),t=a.matches?"dark":"light";e?(e="dark"===e?"light":"dark",localStorage.theme=e,o.setAttribute("data-theme",e),s.setAttribute("style",`background:url('/images/${e}.png')`)):(e="dark"==t?"light":"dark",localStorage.theme=e,o.setAttribute("data-theme",e),s.setAttribute("style",`background:url('/images/${e}.png')`))})},closeSearch=()=>{const e=document.querySelector("main"),t=document.getElementById("search-result"),s=document.getElementById("search-input");t.addEventListener("click",e=>{e.stopPropagation()}),e.addEventListener("click",e=>{t.classList.add("disappear"),s.value=""})},handleNavClick=()=>{const e=document.querySelector(".nav-bar");e.addEventListener("click",e=>{e.stopPropagation()})},controlNav=()=>{const e=document.querySelector(".close-button"),t=document.querySelector(".nav-button"),s=document.querySelector(".nav-bar");if("none"!==getComputedStyle(t).display){const o=document.querySelector(".page-index")??document.querySelector(".post-main")??document.querySelector(".page-main");t.addEventListener("click",e=>{s.classList.add("slide-right"),document.body.classList.add("overflow-hidden"),o&&o.classList.add("blur"),e.stopPropagation(),handleNavClick(),s.classList.contains("slide-right")&&document.documentElement.addEventListener("click",e=>{s.classList.contains("slide-right")&&e.preventDefault(),s.classList.remove("slide-right"),document.body.classList.remove("overflow-hidden"),o&&o.classList.remove("blur")})}),e.addEventListener("click",()=>{s.classList.remove("slide-right"),document.body.classList.remove("overflow-hidden"),o&&o.classList.remove("blur")})}},handleSlide=()=>{const t=document.querySelector(".nav-button");if("none"!==getComputedStyle(t).display){const s={startX:0,endX:0,get width(){return this.endX-this.startX}};window.addEventListener("touchstart",e=>{s.startX=e.changedTouches[0].pageX}),window.addEventListener("touchend",e=>{s.endX=e.changedTouches[0].pageX,150<s.width&&t.click()})}},searchFunc=function(){const s=document.getElementById("search-result"),e=document.getElementById("search-input");e&&fetch("/search.json").then(e=>e.json()).then(t=>{e.addEventListener("input",function(){closeSearch();const c=this.value.trim().toLowerCase();let i=s.innerText="";var e;0===c.replace(/\s*/gi,"").length?s.classList.add("disappear"):(s.classList.remove("disappear"),t.forEach(function(e){let t=!0;e.title&&""!==e.title.trim()||(e.title="Untitled");const s=e.title.trim().toLowerCase(),o=e.content.trim().replace(/(```([A-Za-z]{2,10})*)|(####|\*\*)|(\s-\s)|(\(https:.*\))/gi,"").toLowerCase();var a,e=e.url;let n=-1,r=-1;""!==o&&(a=s.indexOf(c),n=o.indexOf(c),a<0&&n<0?t=!1:(n<0&&(n=0),r=n)),t&&(i+=`<li><a href="${e}" class="search-title">${s}</a>`,0<=r&&(a=r-20,e=r+80,(e=0==(a=a<0?0:a)?100:e)>o.length&&(e=o.length),a=o.substring(a,e),e=new RegExp(c,"gi"),a=a.replace(e,`<span class="search-keyword">${c}</span>`),e=document.createTextNode(a),i+=`<p class="search-content">${e.textContent}...</p>`),i+="</li>")}),0<i.length&&(e=`<ul class="search-result-list">${i}</ul>`,s.innerHTML=e))})})},executeFunc=()=>{setTheme(),pageScroll(),avatarAnimation(),setRecentTime(),searchFunc(),handleTip(),showTip(),disableScale(),controlNav(),handleSlide()};executeFunc();