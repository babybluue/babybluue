<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://babybluue.github.io/posts/9d248dda"><link rel="manifest" href="/manifest.webmanifest"><link rel="apple-touch-icon" sizes="192x192" href="/images/appleicon"><link rel="apple-touch-startup-image" media="(device-width: 750px) and (device-height:1334px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/images/launch"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="babyblue"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1f1f1f"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="color-scheme" content="light dark"><link rel="icon" href="/images/favicon.ico"><meta name="description" content="需求是 前端将通过富文本编辑器产生的 rawHtml 发给后端，在展示的时候需要将后端此时传过来的 rawHtml 直接转化成 pdf 下载查看。这里选择使用 jsPdf 在前端利用 html()方法生成 pdf 文件，但是遇到了中文乱码以及在同时使用 TailwindCSS 导致的标签默认样式被覆盖的问题。 "><meta name="keywords" content="blog,博客,程序员,记录,学习,网站 "><title>jsPdf中文乱码的问题</title><link rel="stylesheet" href="/style/style.css"><link rel="stylesheet" href="/style/highlight.css" media="none" onload='this.media="all"'><link rel="stylesheet" href="/style/fancybox.css" media="none" onload='this.media="all"'><script type="text/javascript">var currentPath=window.location.pathname,targetUrl="https://didmax.pages.dev";window.location.href=targetUrl+currentPath</script><script>localStorage.theme&&document.documentElement.setAttribute("data-theme",localStorage.theme)</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TMJ0G5Z2NR"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TMJ0G5Z2NR")</script><script>document.onreadystatechange=()=>{const t=document.querySelector(".loading-bar");700<document.body.clientWidth&&(t.style.background="#91C4E2","interactive"==document.readyState&&(t.style.transition="width 1.4s ease-in-out",t.style.width="67%"),"complete"==document.readyState&&(t.style.transition="width 0.3s ease-in-out",t.style.width="100%",setTimeout(()=>{t.setAttribute("style","transition:width 0s;width:0;background:''")},500)))}</script><meta name="generator" content="Hexo 5.4.2"></head><body class="scroll-bar"><div class="loading-bar"></div><div class="progress-bar"></div><main><header><nav><ul class="nav-button"><li></li><li></li><li></li></ul><div class="nav-bar"><ul><span class="close-button">×</span><div class="nav-avatar"><a href="/" aria-label="index"><img src="/images/avatar.png" class="avatar" alt="avatar"></a></div><li><a href="/archives/">Archive</a></li><li><a href="/notes/">Notes</a></li><li><a href="/articles/">Articles</a></li><li><a href="mailto:kerrismith19786@gmail.com" rel="external nofollow noreferrer">Contact</a></li></ul></div></nav></header><div class="post-main"><article><div class="post-card"><div class="header-title">jsPdf中文乱码的问题</div><div class="header-info"><span>2023.03.06 Mon</span></div><div class="card-content"><p>需求是 前端将通过富文本编辑器产生的 rawHtml 发给后端，在展示的时候需要将后端此时传过来的 rawHtml 直接转化成 pdf 下载查看。这里选择使用 jsPdf 在前端利用 html()方法生成 pdf 文件，但是遇到了中文乱码以及在同时使用 TailwindCSS 导致的标签默认样式被覆盖的问题。</p><span id="more"></span><h4 id="字体乱码"><a class="markdownIt-Anchor" href="#字体乱码"></a> 字体乱码</h4><ul><li><p>通过翻阅官方文档，找到了关于字体乱码的解决方法--手动添加字体。</p><blockquote><p>Use of Unicode Characters / UTF-8:<br>The 14 standard fonts in PDF are limited to the ASCII-codepage. If you want to use UTF-8 you have to integrate a custom font, which provides the needed glyphs. jsPDF supports .ttf-files. So if you want to have for example Chinese text in your pdf, your font has to have the necessary Chinese glyphs. So, check if your font supports the wanted glyphs or else it will show garbled characters instead of the right text.<br>To add the font to jsPDF use our fontconverter in /fontconverter/fontconverter.html. The fontconverter will create a js-file with the content of the provided ttf-file as base64 encoded string and additional code for jsPDF. You just have to add this generated js-File to your project. You are then ready to go to use setFont-method in your code and write your UTF-8 encoded text.<br>Alternatively you can just load the content of the *.ttf file as a binary string using fetch or XMLHttpRequest and add the font to the PDF file:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title function_">jsPDF</span>()<br><span class="hljs-keyword">const</span> myFont = ... <span class="hljs-comment">// load the \*.ttf font file as binary string</span><br> <span class="hljs-comment">// add the font to jsPDF</span><br>doc.<span class="hljs-title function_">addFileToVFS</span>(<span class="hljs-string">&quot;MyFont.ttf&quot;</span>, myFont);<br>doc.<span class="hljs-title function_">addFont</span>(<span class="hljs-string">&quot;MyFont.ttf&quot;</span>, <span class="hljs-string">&quot;MyFont&quot;</span>, <span class="hljs-string">&quot;normal&quot;</span>);<br>doc.<span class="hljs-title function_">setFont</span>(<span class="hljs-string">&quot;MyFont&quot;</span>);<br></code></pre></td></tr></table></figure></blockquote></li><li><p>方法</p><p>下载中文 ttf 字体(思源宋体)，通过插件提供的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://rawgit.com/MrRio/jsPDF/master/fontconverter/fontconverter.html">转换工具</a>将 ttf 字体文件转成 base64 编码.</p><p><strong>将要输出为 pdf 文件 的 dom 元素设置 font-family 为下载的字体。</strong></p><ul><li><p>html 页面引入 将上面官方生成的 js 文件通过 script 标签引入</p></li><li><p>手动导入<br>用记事本打开生成的 js 文件，将变量 font 导出，删除 font 变量外无用的代码，在需要的地方引入该变量。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; font &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../assets/SourceHanSansCN&#x27;</span><br><br><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title function_">jsPDF</span>(<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;pt&#x27;</span>, <span class="hljs-string">&#x27;a4&#x27;</span>)<br><span class="hljs-keyword">const</span> rawHtml=<span class="hljs-string">&quot;&lt;div style=&#x27;font-family:MyFont;&#x27;&gt;你好&lt;/div&gt;&quot;</span><br><span class="hljs-comment">// add the font to jsPDF</span><br>doc.<span class="hljs-title function_">addFileToVFS</span>(<span class="hljs-string">&#x27;MyFont.ttf&#x27;</span>, font)<br>doc.<span class="hljs-title function_">addFont</span>(<span class="hljs-string">&#x27;MyFont.ttf&#x27;</span>, <span class="hljs-string">&#x27;MyFont&#x27;</span>, <span class="hljs-string">&#x27;normal&#x27;</span>)<br>doc.<span class="hljs-title function_">setFont</span>(<span class="hljs-string">&#x27;MyFont&#x27;</span>)<br>doc.<span class="hljs-title function_">html</span>(rawHtml, &#123; <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">doc</span>) =&gt;</span> doc.<span class="hljs-title function_">save</span>(’test‘), <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">10</span> &#125;)<br></code></pre></td></tr></table></figure></li></ul></li></ul><h4 id="tailwindcss-显示-vanilla-html-排版"><a class="markdownIt-Anchor" href="#tailwindcss-显示-vanilla-html-排版"></a> TailwindCSS 显示 vanilla HTML 排版</h4><p>在使用 TailwindCSS 时，它会修改并覆盖标签的默认样式，如 h1/h2 标签默认样式被取消，这会导致在将需要以正常 html 格式排版时(如富文本编辑器里面标题)样式被 TailwindCSS 覆盖。所以 TailwindCSS 官方提供了排版插件，只需要正确安装插件，使用 prose 样式类即可还原默认 HTML 样式。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -D @tailwindcss/typography<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">theme</span>: &#123;<br>    <span class="hljs-comment">// ...</span><br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@tailwindcss/typography&#x27;</span>),<br>    <span class="hljs-comment">// ...</span><br>  ],<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- 添加prose --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;prose&quot;</span>&gt;</span>I Have A Dream<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure></div></div></article><div class="post-pagination"><div class="prev-page"><a href="/posts/ce03c2ea" title="VSCode编写gql语句时根据GraphQL Schema自动补全">VSCode编写gql语句时根据GraphQL Schema自动补全</a></div><div class="next-page"><a href="/posts/3c3241df" title=".eslintrc、.bashrc等配置文件的后缀rc是什么意思 ">.eslintrc、.bashrc等配置文件的后缀rc是什么意思</a></div></div></div><svg t="1673947892053" class="top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9313" width="45" height="45"><path d="M535.12 442.432v210.016a16 16 0 0 1-16 16h-16.16a16 16 0 0 1-16-16V440.208l-32.88 32.864a16 16 0 0 1-11.312 4.688h-28.304a14.464 14.464 0 0 1-10.24-24.688l97.824-97.808a11.136 11.136 0 0 1 15.744 0l97.808 97.808a14.464 14.464 0 0 1-10.24 24.688h-28.288a16 16 0 0 1-11.312-4.688l-30.64-30.64zM512 800c159.056 0 288-128.944 288-288s-128.944-288-288-288-288 128.944-288 288 128.944 288 288 288z m0 48c-185.568 0-336-150.432-336-336s150.432-336 336-336 336 150.432 336 336-150.432 336-336 336z" p-id="9314"></path></svg><div class="tip disappear"><p>检测到页面内容有更新，是否刷新页面 <span class="positive-btn">是</span><span class="negative-btn">否</span></p></div></main><script src="/scripts/script.js" async></script><script async type="module">import{Fancybox}from"/scripts/fancybox.esm.js";Fancybox.bind('[data-fancybox="gallery"]',{Toolbar:{display:["fullscreen","download","close"]}})</script></body></html>