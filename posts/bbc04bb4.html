<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://babybluue.github.io/posts/bbc04bb4"><link rel="manifest" href="/manifest.webmanifest"><link rel="apple-touch-icon" sizes="192x192" href="/images/appleicon"><link rel="apple-touch-startup-image" media="(device-width: 750px) and (device-height:1334px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/images/launch"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="babyblue"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1f1f1f"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="color-scheme" content="light dark"><link rel="icon" href="/images/favicon.ico"><meta name="description" content="在项目目录下运行npm init会生成一个 package.json 文件，里面包含了项目的信息。 "><meta name="keywords" content="blog,博客,程序员,记录,学习,网站 "><title>学习Node.js</title><link rel="stylesheet" href="/style/style.css"><link rel="stylesheet" href="/style/highlight.css" media="none" onload='this.media="all"'><link rel="stylesheet" href="/style/fancybox.css" media="none" onload='this.media="all"'><script type="text/javascript">var currentPath=window.location.pathname,targetUrl="https://didmax.pages.dev";window.location.href=targetUrl+currentPath</script><script>localStorage.theme&&document.documentElement.setAttribute("data-theme",localStorage.theme)</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TMJ0G5Z2NR"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TMJ0G5Z2NR")</script><script>document.onreadystatechange=()=>{const t=document.querySelector(".loading-bar");700<document.body.clientWidth&&(t.style.background="#91C4E2","interactive"==document.readyState&&(t.style.transition="width 1.4s ease-in-out",t.style.width="67%"),"complete"==document.readyState&&(t.style.transition="width 0.3s ease-in-out",t.style.width="100%",setTimeout(()=>{t.setAttribute("style","transition:width 0s;width:0;background:''")},500)))}</script><meta name="generator" content="Hexo 5.4.2"></head><body class="scroll-bar"><div class="loading-bar"></div><div class="progress-bar"></div><main><header><nav><ul class="nav-button"><li></li><li></li><li></li></ul><div class="nav-bar"><ul><span class="close-button">×</span><div class="nav-avatar"><a href="/" aria-label="index"><img src="/images/avatar.png" class="avatar" alt="avatar"></a></div><li><a href="/archives/">Archive</a></li><li><a href="/notes/">Notes</a></li><li><a href="/articles/">Articles</a></li><li><a href="mailto:kerrismith19786@gmail.com" rel="external nofollow noreferrer">Contact</a></li></ul></div></nav></header><div class="post-main"><article><div class="post-card"><div class="header-title">学习Node.js</div><div class="header-info"><span>2021.06.09 Wed</span></div><div class="card-content"><p>NodeJS 是运行在服务端的 Javascript,基于 Google 的 Chrome V8 引擎。NPM 是随同 NodeJS 一起安装的包管理工具，用来安装第三方的模块。<br>通过 node 命令可以运行一个 js 文件<code>node index.js</code>,在命令行里输入 node 可以进入 REPL(Read Eval Print Loop:交互式解释器) 环境运行 js 代码。</p><h4 id="初始化一个项目"><a class="markdownIt-Anchor" href="#初始化一个项目"></a> 初始化一个项目</h4><p>在项目目录下运行<code>npm init</code>会生成一个 package.json 文件，里面包含了项目的信息。</p><span id="more"></span><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;backend&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;index.js&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Matti Luukkainen&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MIT&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>如上，文件定义的入口点是 index.js,其中 scripts 里的前两个命令可以通过<code>npm start</code> <code>npm test</code>运行</p><h4 id="简单的-web-服务器"><a class="markdownIt-Anchor" href="#简单的-web-服务器"></a> 简单的 web 服务器</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>); <span class="hljs-comment">//应用导入Node的内置Web server模块</span><br><br><span class="hljs-keyword">const</span> app = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123; <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/plain&#x27;</span> &#125;);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;Hello motherfucker&#x27;</span>);<br>&#125;);<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3100</span>;<br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running on port <span class="hljs-subst">$&#123;PORT&#125;</span>`</span>);<br></code></pre></td></tr></table></figure><h4 id="使用-express"><a class="markdownIt-Anchor" href="#使用-express"></a> 使用 Express</h4><p>直接使用 Node 内置的 http web 服务器实现我们的服务器代码是可行的。 但是，它很麻烦，特别是当应用规模“变大变长”时。</p><p>为了提供一个比内置的 http 模块更友好的界面，许多库已经开发出来，以简化使用 Node 作为服务器端开发。这些库致力于为构建后台服务器的一般的用例提供一个更好的抽象，到目前为止，最受欢迎的库是 express。</p><p>安装 express 项目依赖<code>npm install express</code>,事情会在 package.json 记录下来。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;express&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.17.1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>依赖的源代码安装在项目根目录中的 node_modules 目录中。 除了 express，你还可以在目录中找到大量的其他依赖项,这些实际上是 express 的依赖项，以及它所有依赖项的依赖项，等等。 这些被称为我们项目的 传递依赖 transitive dependencies 。</p><ul><li><p>npm 中的语义版本模型<br>npm 的版本号由三部分组成：<br>主版本号、次版本号、补丁版本号。变更不同的版本号，代表不同的意义：<br>主版本号（major）：软件做了不兼容的变更（breaking change 重大变更）；<br>次版本号（minor）：添加功能或者废弃功能，向下兼容；<br>补丁版本号（patch）：bug 修复，向下兼容。</p></li><li><p>~version<br>不改变主版本号和次版本号,补丁版本号随意<br>注意:<br>如果按照版本号格式,X.Y.Z,那么补丁版本号就是随意<br>如: ~2.2.1, 表示 &gt;=2.2.1 &lt;2.3.0 版的依赖包 (可以是 2.2.1, 2.2.2, 2.2.3, …, 2.2.n)<br>如果版本号格式,X.Y,那么跟正规格式的意义相同<br>如果版本号格式,X,那么次要版本号和补丁版本号可以随意<br>如: ~2, 表示 &gt;=2.0.0 &lt; 3.0.0 版的依赖包 (可以是 2.0.0, 2.0.n, 2.1.0, …, 2.n.n)</p></li><li><p>^version<br>版本号最左边非 0 数字的右侧可以任意<br>如: ^2.2.1,表示 &gt;=2.2.1 &lt; 3.0.0 版依赖包<br>^0.2.1,表示 &gt;=0.2.1 &lt;0.3.0 版依赖包<br>^0.0,表示 &gt;=0.0.0 &lt;0.1.0 版依赖包</p></li></ul><p>使用 express 改写上面的代码:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Hello world!&lt;/h1&gt;&#x27;</span>);<br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3001</span>;<br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running on port <span class="hljs-subst">$&#123;PORT&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="设置-npm-代理"><a class="markdownIt-Anchor" href="#设置-npm-代理"></a> 设置 npm 代理</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm config <span class="hljs-built_in">set</span> proxy=http://127.0.0.1:10809 <span class="hljs-comment">#设置代理</span><br><br>npm config delete proxy <span class="hljs-comment">#取消代理</span><br></code></pre></td></tr></table></figure><h4 id="安装-nodemon"><a class="markdownIt-Anchor" href="#安装-nodemon"></a> 安装 nodemon</h4><p>nodemon 将监视启动 nodemon 的目录中的文件，如果任何文件发生更改，nodemon 将自动重启 node 应用。<br>通过命令<code>npm install -D nodemon</code>将 nodemon 定义为开发依赖 development dependency,package.json 的内容也发生了变化</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;express&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.17.1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;nodemon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^2.0.7&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>通过开发依赖，会指向仅在应用开发过程中需要的工具，例如用于测试或自动重启应用的工具，就像 nodemon。<br>当应用在生产服务器(例如 Heroku)的生产模式下运行时，并不需要这些开发依赖项。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-comment">// ..</span><br>  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nodemon index.js&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">//添加nodemon命令脚本</span><br>    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">// ..</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>与 start 和 test 脚本不同，其他的脚本运行命令需要加 run<code>npm run dev</code></p><h4 id="几种依赖"><a class="markdownIt-Anchor" href="#几种依赖"></a> 几种依赖</h4><ul><li>dependencies<br>这是 npm 最基本的依赖，<code>npm i xxx</code>来安装一个包并且添加到 package.json 的 dependencies 里面。<br><code>npm i xxx @0.0.1</code>@指明版本号，否则会安装当前包的最新版本</li><li>devDependencies<br>开发中使用的依赖，为了开发方便而使用依赖，如构建工具、预处理器、测试工具等。<br><code>npm i -D xxx</code> 添加到 package.json 的 devDependencies 里面。</li><li>peerDependencies<br>针对的是 npm 包的开发者使用，在项目主体里开发一个插件，这个插件的功能实现并不需要依赖它的项目主体，但是项目主体却还是它的宿主。<br>因此当想要使用这个插件的时候，必须也要安装它的宿主项目，peerDependencies 就是声明插件与宿主的关系的。</li></ul><h4 id="node-的模块"><a class="markdownIt-Anchor" href="#node-的模块"></a> Node 的模块</h4><ul><li><p>module.exports={app} 或者 module.exports=app</p></li><li><p>const {app}=require('') 或者 const app=require('')</p></li></ul><h4 id="全局变量"><a class="markdownIt-Anchor" href="#全局变量"></a> 全局变量</h4><ul><li>__filename 表示当前正在执行的脚本的文件名，输出文件所在位置的绝对路径</li><li>__dirname 表示当前执行脚本所在的目录</li><li>process 用于描述当前 Node.js 进程状态的对象，提供了一个与操作系统的简单接口。<br>事件：exit beforeExit uncaughtException Sinal 事件<br>属性：stdout stderr stdin argv env...<br>方法：abort() chdir() cwd() nextTick(callback)...</li></ul><h4 id="文件系统"><a class="markdownIt-Anchor" href="#文件系统"></a> 文件系统</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> fs=<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs)</span><br></code></pre></td></tr></table></figure><p>Node.js 文件系统（fs 模块）模块中的方法均有异步和同步版本，例如读取文件内容的函数有异步的 fs.readFile() 和同步的 fs.readFileSync()。<br>异步的方法函数最后一个参数为回调函数，回调函数的第一个参数包含了错误信息(error)。<br>比起同步，异步方法性能更高，速度更快，而且没有阻塞。</p><ul><li>读取文件<br><code>fs.readFile(filename[, options], callback)</code></li><li>打开文件<br><code>fs.open(path, flags[, mode], callback)</code></li><li>获取文件信息<br><code>fs.stat(path, callback)</code></li><li>写入文件<br><code>fs.writeFile(file, data[, options], callback)</code><br>....</li></ul><hr><p>参考链接:<br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://fullstackopen.com/zh/part3/node_js_%E4%B8%8E_express">Node.js 与 Express</a><br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://nodejs.org/es/blog/npm/peer-dependencies/">peerDependencies</a></p></div><div class="post-tags"><a href="/tags/JavaScript/">JavaScript</a></div></div></article><div class="post-pagination"><div class="prev-page"><a href="/posts/3c1ca5d8" title="情绪ABC理论">情绪ABC理论</a></div><div class="next-page"><a href="/posts/d4035720" title="人间失格-太宰治 ">人间失格-太宰治</a></div></div></div><svg t="1673947892053" class="top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9313" width="45" height="45"><path d="M535.12 442.432v210.016a16 16 0 0 1-16 16h-16.16a16 16 0 0 1-16-16V440.208l-32.88 32.864a16 16 0 0 1-11.312 4.688h-28.304a14.464 14.464 0 0 1-10.24-24.688l97.824-97.808a11.136 11.136 0 0 1 15.744 0l97.808 97.808a14.464 14.464 0 0 1-10.24 24.688h-28.288a16 16 0 0 1-11.312-4.688l-30.64-30.64zM512 800c159.056 0 288-128.944 288-288s-128.944-288-288-288-288 128.944-288 288 128.944 288 288 288z m0 48c-185.568 0-336-150.432-336-336s150.432-336 336-336 336 150.432 336 336-150.432 336-336 336z" p-id="9314"></path></svg><div class="tip disappear"><p>检测到页面内容有更新，是否刷新页面 <span class="positive-btn">是</span><span class="negative-btn">否</span></p></div></main><script src="/scripts/script.js" async></script><script async type="module">import{Fancybox}from"/scripts/fancybox.esm.js";Fancybox.bind('[data-fancybox="gallery"]',{Toolbar:{display:["fullscreen","download","close"]}})</script></body></html>