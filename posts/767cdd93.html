<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://babybluue.github.io/posts/767cdd93"><link rel="manifest" href="/manifest.webmanifest"><link rel="apple-touch-icon" sizes="192x192" href="/images/appleicon"><link rel="apple-touch-startup-image" media="(device-width: 750px) and (device-height:1334px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/images/launch"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="babyblue"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1f1f1f"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="color-scheme" content="light dark"><link rel="icon" href="/images/favicon.ico"><meta name="description" content="DOMContentLoaded 与 load 事件: "><meta name="keywords" content="blog,博客,程序员,记录,学习,网站 "><title>网页加载进度条</title><link rel="stylesheet" href="/style/style.css"><link rel="stylesheet" href="/style/highlight.css" media="none" onload='this.media="all"'><link rel="stylesheet" href="/style/fancybox.css" media="none" onload='this.media="all"'><script type="text/javascript">var currentPath=window.location.pathname,targetUrl="https://didmax.pages.dev";window.location.href=targetUrl+currentPath</script><script>localStorage.theme&&document.documentElement.setAttribute("data-theme",localStorage.theme)</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TMJ0G5Z2NR"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TMJ0G5Z2NR")</script><script>document.onreadystatechange=()=>{const t=document.querySelector(".loading-bar");700<document.body.clientWidth&&(t.style.background="#91C4E2","interactive"==document.readyState&&(t.style.transition="width 1.4s ease-in-out",t.style.width="67%"),"complete"==document.readyState&&(t.style.transition="width 0.3s ease-in-out",t.style.width="100%",setTimeout(()=>{t.setAttribute("style","transition:width 0s;width:0;background:''")},500)))}</script><meta name="generator" content="Hexo 5.4.2"></head><body class="scroll-bar"><div class="loading-bar"></div><div class="progress-bar"></div><main><header><nav><ul class="nav-button"><li></li><li></li><li></li></ul><div class="nav-bar"><ul><span class="close-button">×</span><div class="nav-avatar"><a href="/" aria-label="index"><img src="/images/avatar.png" class="avatar" alt="avatar"></a></div><li><a href="/archives/">Archive</a></li><li><a href="/notes/">Notes</a></li><li><a href="/articles/">Articles</a></li><li><a href="mailto:kerrismith19786@gmail.com" rel="external nofollow noreferrer">Contact</a></li></ul></div></nav></header><div class="post-main"><article><div class="post-card"><div class="header-title">网页加载进度条</div><div class="header-info"><span>2021.03.24 Wed</span></div><div class="card-content"><p>document.readyState 属性描述了文档的加载状态，发生变化时，会在 document 对象上触发 readyStateChange 事件。<br>document.readyState 有三种状态，loading、interactive、complete</p><ul><li>loading document 仍在加载</li><li>interactive 文档已被解析，&quot;正在加载&quot;状态结束，但是诸如图像，样式表和框架之类的子资源仍在加载。</li><li>complete 文档和所有子资源已完成加载。表示 load 状态的事件即将被触发。</li></ul><span id="more"></span><p>DOMContentLoaded 与 load 事件:</p><blockquote><p>The load event is fired when the whole page has loaded, including all dependent resources such as stylesheets and images. This is in contrast to DOMContentLoaded, which is fired as soon as the page DOM has been loaded, without waiting for resources to finish loading.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;load&#x27;</span>);<br>&#125;);<br><br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;readystatechange&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">readyState</span>);<br>&#125;);<br><br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;COMContentLoaded&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>运行结果:<br>interactive COMContentLoaded complete load</p><p>于是可以根据文档的加载属性 document.readyState 捕捉到不同的加载状态来设置加载动画。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> headBar = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.header-bar&#x27;</span>);<br>  headBar.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">&#x27;lightblue&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">readyState</span> == <span class="hljs-string">&#x27;interactive&#x27;</span>) &#123;<br>    headBar.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">&#x27;width 1.4s ease-in-out&#x27;</span>;<br>    headBar.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&#x27;67%&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">readyState</span> == <span class="hljs-string">&#x27;complete&#x27;</span>) &#123;<br>    headBar.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">&#x27;width 0.3s ease-in-out&#x27;</span>;<br>    headBar.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&#x27;100%&#x27;</span>;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      headBar.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;style&#x27;</span>, <span class="hljs-string">&quot;transition:width 0s;width:0;background:&#x27;&#x27;&quot;</span>);<br>    &#125;, <span class="hljs-number">500</span>);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></div><div class="post-tags"><a href="/tags/JavaScript/">JavaScript</a></div></div></article><div class="post-pagination"><div class="prev-page"><a href="/posts/c85f1380" title="Bakgorund属性">Bakgorund属性</a></div><div class="next-page"><a href="/posts/a37770e5" title="页面阅读进度 ">页面阅读进度</a></div></div></div><svg t="1673947892053" class="top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9313" width="45" height="45"><path d="M535.12 442.432v210.016a16 16 0 0 1-16 16h-16.16a16 16 0 0 1-16-16V440.208l-32.88 32.864a16 16 0 0 1-11.312 4.688h-28.304a14.464 14.464 0 0 1-10.24-24.688l97.824-97.808a11.136 11.136 0 0 1 15.744 0l97.808 97.808a14.464 14.464 0 0 1-10.24 24.688h-28.288a16 16 0 0 1-11.312-4.688l-30.64-30.64zM512 800c159.056 0 288-128.944 288-288s-128.944-288-288-288-288 128.944-288 288 128.944 288 288 288z m0 48c-185.568 0-336-150.432-336-336s150.432-336 336-336 336 150.432 336 336-150.432 336-336 336z" p-id="9314"></path></svg><div class="tip disappear"><p>检测到页面内容有更新，是否刷新页面 <span class="positive-btn">是</span><span class="negative-btn">否</span></p></div></main><script src="/scripts/script.js" async></script><script async type="module">import{Fancybox}from"/scripts/fancybox.esm.js";Fancybox.bind('[data-fancybox="gallery"]',{Toolbar:{display:["fullscreen","download","close"]}})</script></body></html>